<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Update Donasi - Bencana Aceh, Sumut, Sumbar</title>
  <link rel="stylesheet" href="https://unpkg.com/swiper@9/swiper-bundle.min.css" />
  <style>
    :root{--bg:#f9fafb;--card:#ffffff;--accent:#0b8f47;--accent2:#ffc928;--muted:#4b5563;--glass:rgba(0,0,0,0.05)}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;color:#111827;background:linear-gradient(180deg,#f3f7f5 0%, #e9f4eb 100%);-webkit-font-smoothing:antialiased}
    .container{max-width:980px;margin:28px auto;padding:16px}

    header{display:flex;gap:12px;align-items:center;margin-bottom:18px;color:#111827}
    .title{flex:1;color:#111827}
    h1{margin:0;font-size:20px;letter-spacing:-0.2px;color:#111827}
    p.lead{margin:4px 0 0;color:var(--muted);font-size:13px}

    .card{background:rgba(255,255,255,0.92);border-radius:14px;padding:14px;box-shadow:0 4px 14px rgba(0,0,0,0.08);backdrop-filter:blur(4px);border:1px solid rgba(0,0,0,0.05);color:#111827}

    /* Progress */
    .progress-wrap{margin-top:12px;color:#111827}
    .progress-labels{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;color:#111827}
    .goal{font-size:13px;color:var(--muted)}
    .total{font-weight:700;color:#111827}
    .progress-bar{height:18px;background:var(--glass);border-radius:999px;overflow:hidden;position:relative}
    .progress-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent2));border-radius:999px;display:flex;align-items:center;justify-content:flex-end;padding-right:8px;color:#05202a;font-weight:700;transition:width 1.2s cubic-bezier(.2,.9,.3,1)}
    .progress-fill .percent{font-size:12px}

    /* Donor list */
    .donor-list{margin-top:16px;display:grid;gap:8px;color:#111827}
    .donor-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;background:rgba(255,255,255,0.4);border:1px solid rgba(0,0,0,0.05);color:#111827}
    .donor-item .name{font-weight:600;color:#111827}
    .donor-item .amount{font-weight:700;color:#111827}
    .muted{color:var(--muted);font-size:13px}

    /* slider */
    .slider-area{margin-top:18px;color:#111827}
    .swiper{width:100%;height:120px}
    .swiper-slide{display:flex;align-items:center;justify-content:center}
    .donor-photo{width:84px;height:84px;border-radius:10px;object-fit:cover;box-shadow:0 6px 18px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}

    /* animations */
    .fade-up{opacity:0;transform:translateY(12px);transition:all 500ms cubic-bezier(.2,.9,.3,1)}
    .fade-up.inview{opacity:1;transform:none}

    @media(min-width:720px){h1{font-size:22px}.swiper{height:160px}.donor-photo{width:110px;height:110px}}

    .hint{font-size:12px;color:var(--muted);margin-top:8px}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <header>
        <div class="title">
          <h1>Update Donasi — Bencana Aceh, Sumatera Utara & Sumatera Barat</h1>
          <p class="lead">Realtime tracker donasi. Data diambil dari Google Sheets dan foto dari Google Drive.</p>
        </div>
        <div style="text-align:right">
          <div class="muted">Terakhir diperbarui:</div>
          <div id="updatedAt" class="muted">—</div>
        </div>
      </header>

      <section class="progress-wrap fade-up" id="progressSection">
        <div class="progress-labels">
          <div>
            <div class="goal">Target Donasi</div>
            <div id="goalAmount" class="muted">—</div>
          </div>
          <div>
            <div class="goal">Terkumpul</div>
            <div id="totalAmount" class="total">—</div>
          </div>
        </div>
        <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100">
          <div class="progress-fill" id="progressFill"><span class="percent" id="percentLabel">0%</span></div>
        </div>
        <div class="hint">Progress bar menunjukkan persentase dari target.</div>
      </section>

      <section class="donor-list fade-up" id="donorList">
      </section>

      <section class="slider-area fade-up">
        <h3 style="margin:10px 0 8px">Foto Donatur</h3>
        <div class="swiper">
          <div class="swiper-wrapper" id="swiperWrapper"></div>
          <div class="swiper-pagination"></div>
        </div>
      </section>

    </div>
  </div>

  <script src="https://unpkg.com/swiper@9/swiper-bundle.min.js"></script>
  <script>
    const CONFIG = {
      SPREADSHEET_ID: '174nwxIbq3bIgCP-l2wcVU4HSkV_1aTTonyDHW4k7gIg',
      SHEET_NAME: 'sheet1',
      GOAL_AMOUNT: 50000000
    }

    function formatRupiah(number){
      if(number==null) return '-';
      return 'Rp ' + Number(number).toLocaleString('id-ID');
    }

    async function fetchSheetCsv(spreadsheetId, sheetName){
      const sheetParam = sheetName ? '&sheet=' + encodeURIComponent(sheetName) : '';
      const url = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/gviz/tq?tqx=out:csv${sheetParam}`;
      const res = await fetch(url);
      if(!res.ok) throw new Error('Gagal mengambil data dari Google Sheets');
      const text = await res.text();
      return parseCsv(text);
    }

    function parseCsv(csvText){
      const rows = csvText.trim().split(/
?
/);
      if(rows.length<2) return [];
      const headers = rows[0].split(',').map(h => h.trim());
      return rows.slice(1).map(r => {
        const cols = r.match(/(?:"([^"]*)")|([^,]+)/g).map(c=>c.replace(/^"|"$/g,''));
        const obj = {};
        headers.forEach((h,i)=>obj[h]=cols[i] ? cols[i].trim() : '');
        return obj;
      });
    }

    async function init(){
      const updatedAtEl = document.getElementById('updatedAt');
      const goalEl = document.getElementById('goalAmount');
      const totalEl = document.getElementById('totalAmount');
      const fill = document.getElementById('progressFill');
      const percentLabel = document.getElementById('percentLabel');
      const donorList = document.getElementById('donorList');
      const swiperWrapper = document.getElementById('swiperWrapper');

      goalEl.textContent = formatRupiah(CONFIG.GOAL_AMOUNT);

      try{
        if(!CONFIG.SPREADSHEET_ID){ throw new Error('SPREADSHEET_ID belum diatur.'); }

        const rows = await fetchSheetCsv(CONFIG.SPREADSHEET
