<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Donasi</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
  <style>
    body { 
      font-family: Arial, sans-serif; 
      padding: 20px; 
      background: #f5f5f5; 
    }

    .container { 
      max-width: 800px; 
      margin: auto; 
      text-align: center;
    }

    /* LOGO */
    .logo {
      width: 120px;
      margin: 0 auto 20px auto;
      display: block;
    }

    .progress-bar { 
      background: #ddd; 
      border-radius: 8px; 
      overflow: hidden; 
      height: 24px; 
    }

    #progressFill { 
      background: #4caf50; 
      height: 100%; 
      width: 0; 
      transition: 1s; 
    }

    .donor-item { 
      display: flex; 
      justify-content: space-between; 
      padding: 10px; 
      background: #fff; 
      margin-top: 8px; 
      border-radius: 6px; 
    }

    /* FOTO DONATUR FULL, TIDAK TERPOTONG */
    .donor-photo { 
      width: 100%; 
      height: 250px; 
      object-fit: contain;       /* FOTO TIDAK TERPOTONG */
      background: #00000020;     /* BACKGROUND TRANSPARAN */
      border-radius: 8px; 
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- LOGO -->
    <img src="https://joshmedia2023.github.io/siazamfile/asset/logobaz.png" alt="Logo" class="logo" />

    <h2>Progress Donasi</h2>
    <p>Target: <span id="goalAmount"></span></p>
    <p>Terkumpul: <span id="totalAmount"></span></p>

    <div class="progress-bar">
      <div id="progressFill"></div>
    </div>
    <p><strong id="percentLabel"></strong></p>

    <h3>Foto Donatur</h3>
    <div class="swiper">
      <div class="swiper-wrapper" id="swiperWrapper"></div>
      <div class="swiper-pagination"></div>
    </div>

    <h3>Daftar Donatur</h3>
    <div id="donorList"></div>

    <p>Diperbarui: <span id="updatedAt"></span></p>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>

  <script>
    const CONFIG = {
      CSV_URL: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRG0tlowgCqkCOUUZayH4Myis8MUPNHWMJyl-3-xzoDOAkZbrwgxEdLSJ2EBVVIVjIK96LqWEjm4JnV/pub?gid=0&single=true&output=csv",
      GOAL_AMOUNT: 50000000
    };

    function formatRupiah(n){ 
      return "Rp " + Number(n).toLocaleString("id-ID"); 
    }

    async function fetchSheetCsv(){
      const res = await fetch(CONFIG.CSV_URL);
      const text = await res.text();
      return parseCsv(text);
    }

    function parseCsv(csv){
      const rows = csv.trim().split(/\r?\n/);
      const headers = rows[0].split(",");
      return rows.slice(1).map(r => {
        const cols = r.match(/(?:"([^"]*)")|([^,]+)/g).map(c => c.replace(/^"|"$/g, ""));
        const obj = {}; 
        headers.forEach((h,i)=> obj[h.trim().toLowerCase()] = cols[i] || "");
        return obj;
      });
    }

    async function init(){
      const updatedAtEl = document.getElementById("updatedAt");
      const goalEl = document.getElementById("goalAmount");
      const totalEl = document.getElementById("totalAmount");
      const fill = document.getElementById("progressFill");
      const percentLabel = document.getElementById("percentLabel");
      const donorList = document.getElementById("donorList");
      const swiperWrapper = document.getElementById("swiperWrapper");

      goalEl.textContent = formatRupiah(CONFIG.GOAL_AMOUNT);

      const rows = await fetchSheetCsv();
      let total = 0;

      const donors = rows.map(r => {
        const name = r["donor_name"] || r["nama"] || "Anonim";
        const amount = Number((r["amount"] || "0").replace(/[^0-9]/g, ""));
        const photo = r["photo_url"] || "";
        total += amount;
        return { name, amount, photo };
      }).sort((a,b)=> b.amount - a.amount);

      totalEl.textContent = formatRupiah(total);
      const percent = Math.min(100, Math.round((total / CONFIG.GOAL_AMOUNT) * 100));
      fill.style.width = percent + "%";
      percentLabel.textContent = percent + "%";

      donorList.innerHTML = "";
      donors.forEach(d => {
        donorList.innerHTML += `
          <div class="donor-item">
            <div>${d.name}</div>
            <div>${formatRupiah(d.amount)}</div>
          </div>`;
      });

      swiperWrapper.innerHTML = "";
      donors.filter(d => d.photo).forEach(p => {
        swiperWrapper.innerHTML += `
          <div class="swiper-slide">
            <img class="donor-photo" src="${p.photo}" />
          </div>`;
      });

      new Swiper('.swiper', {
        slidesPerView: 'auto',
        spaceBetween: 12,
        loop: true,
        autoplay: { delay: 2500 }
      });

      updatedAtEl.textContent = new Date().toLocaleString("id-ID");
    }

    init();
  </script>
</body>
</html>
