<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Donasi</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />

  <style>
    * {
      box-sizing: border-box;
      transition: all 0.25s ease-in-out;
    }

    body { 
      font-family: Arial, sans-serif; 
      padding: 20px; 
      background: #f5f5f5; 
    }

    .container { 
      max-width: 900px; 
      margin: auto; 
      text-align: center;
    }

    /* LOGO */
    .logo {
      width: 140px;
      margin: 0 auto 20px auto;
      display: block;
    }

    /* PROGRESS BAR */
    .progress-bar { 
      background: #e0e0e0; 
      border-radius: 14px; 
      overflow: hidden; 
      height: 26px; 
      margin-top: 10px;
    }

    #progressFill { 
      background: linear-gradient(90deg, #4caf50, #8bc34a); 
      height: 100%; 
      width: 0; 
      transition: width 1s ease;
    }

    /* DONOR ITEM */
    .donor-item { 
      display: flex; 
      justify-content: space-between;
      align-items: center;
      padding: 14px; 
      background: #fff; 
      margin-top: 10px; 
      border-radius: 12px; 
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);

      /* TYPOGRAPHY RESPONSIF */
      font-size: clamp(13px, 3.2vw, 18px);  /* otomatis menyesuaikan layar */
      font-weight: 600;
    }

    .donor-item div:first-child {
      text-align: left;
      flex: 1;
      padding-right: 10px;
      word-break: break-word;
    }

    .donor-item div:last-child {
      white-space: nowrap;
    }

    /* SWIPER FOTO */
    .swiper {
      width: 100%;
      padding: 10px 0 25px 0;
    }

    .swiper-slide {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .donor-photo { 
      width: 100%; 
      max-width: 300px;
      height: auto; 
      object-fit: contain;
      background: transparent;
      border-radius: 16px; 
      display: block;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .donor-photo:hover {
      transform: scale(1.03);
      box-shadow: 0 8px 18px rgba(0,0,0,0.20);
    }

    /* RESPONSIVE */
    @media (max-width: 768px) {
      .donor-photo { max-width: 240px; }
      .donor-item { padding: 12px; }
    }

    @media (max-width: 480px) {
      .donor-photo { max-width: 200px; }
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- LOGO -->
    <img src="https://joshmedia2023.github.io/siazamfile/asset/logobaz.png" alt="Logo" class="logo" />

    <h2>Progress Donasi untuk Bencana di Aceh, Sumatera Utara dan Sumatera Barat - BAZNAS Kabupaten Sragen</h2>
    <p>Target: <span id="goalAmount"></span></p>
    <p>Terkumpul: <span id="totalAmount"></span></p>

    <div class="progress-bar">
      <div id="progressFill"></div>
    </div>
    <p><strong id="percentLabel"></strong></p>

    <h3>Foto Donatur</h3>
    <div class="swiper">
      <div class="swiper-wrapper" id="swiperWrapper"></div>
      <div class="swiper-pagination"></div>
    </div>

    <h3>Daftar Donatur</h3>
    <div id="donorList"></div>

    <p>Diperbarui: <span id="updatedAt"></span></p>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>

  <script>
    const CONFIG = {
      CSV_URL: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRG0tlowgCqkCOUUZayH4Myis8MUPNHWMJyl-3-xzoDOAkZbrwgxEdLSJ2EBVVIVjIK96LqWEjm4JnV/pub?gid=0&single=true&output=csv",
      GOAL_AMOUNT: 200000000
    };

    function formatRupiah(n){ 
      return "Rp " + Number(n).toLocaleString("id-ID"); 
    }

    async function fetchSheetCsv(){
      const res = await fetch(CONFIG.CSV_URL);
      const text = await res.text();
      return parseCsv(text);
    }

    function parseCsv(csv){
      const rows = csv.trim().split(/\r?\n/);
      const headers = rows[0].split(",");
      return rows.slice(1).map(r => {
        const cols = r.match(/(?:"([^"]*)")|([^,]+)/g).map(c => c.replace(/^"|"$/g, ""));
        const obj = {}; 
        headers.forEach((h,i)=> obj[h.trim().toLowerCase()] = cols[i] || "");
        return obj;
      });
    }

    async function init(){
      const updatedAtEl = document.getElementById("updatedAt");
      const goalEl = document.getElementById("goalAmount");
      const totalEl = document.getElementById("totalAmount");
      const fill = document.getElementById("progressFill");
      const percentLabel = document.getElementById("percentLabel");
      const donorList = document.getElementById("donorList");
      const swiperWrapper = document.getElementById("swiperWrapper");

      goalEl.textContent = formatRupiah(CONFIG.GOAL_AMOUNT);

      const rows = await fetchSheetCsv();
      let total = 0;

      const donors = rows.map(r => {
        const name = r["donor_name"] || r["nama"] || "Anonim";
        const amount = Number((r["amount"] || "0").replace(/[^0-9]/g, ""));
        const photo = r["photo_url"] || "";
        total += amount;
        return { name, amount, photo };
      }).sort((a,b)=> b.amount - a.amount);

      totalEl.textContent = formatRupiah(total);
      const percent = Math.min(100, Math.round((total / CONFIG.GOAL_AMOUNT) * 100));
      fill.style.width = percent + "%";
      percentLabel.textContent = percent + "%";

      donorList.innerHTML = "";
      donors.forEach(d => {
        donorList.innerHTML += `
          <div class="donor-item">
            <div>${d.name}</div>
            <div>${formatRupiah(d.amount)}</div>
          </div>`;
      });

      swiperWrapper.innerHTML = "";
      donors.filter(d => d.photo).forEach(p => {
        swiperWrapper.innerHTML += `
          <div class="swiper-slide">
            <img class="donor-photo" src="${p.photo}" />
          </div>`;
      });

      new Swiper('.swiper', {
        slidesPerView: 'auto',
        spaceBetween: 12,
        loop: true,
        autoplay: { delay: 2500 },
        centeredSlides: true,
        pagination: { el: '.swiper-pagination', clickable: true },
      });

      updatedAtEl.textContent = new Date().toLocaleString("id-ID");
    }

    init();
  </script>
</body>
</html>
